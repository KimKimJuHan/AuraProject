name: Game Data Collector

on:
  schedule:
    - cron: '0 10 * * *' # 매일 한국시간 19:00 (UTC 10:00) 실행
  workflow_dispatch: # 수동 실행 가능

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20' # Node.js 20 사용 (필수)

    - name: Install Dependencies
      run: |
        cd backend
        npm install

    - name: Seed Databases (필요시 주석 해제하여 사용)
      run: |
        cd backend
        # node metadata_seeder.js  # 가격 족보 업데이트 시 주석 해제
        # node category_seeder.js  # 트렌드 족보 업데이트 시 주석 해제

    - name: Run Collector
      run: node backend/collector.js
      env:
        MONGODB_URI: ${{ secrets.MONGODB_URI }}
        ITAD_API_KEY: ${{ secrets.ITAD_API_KEY }}
        TWITCH_CLIENT_ID: ${{ secrets.TWITCH_CLIENT_ID }}
        TWITCH_CLIENT_SECRET: ${{ secrets.TWITCH_CLIENT_SECRET }}
        CHZZK_CLIENT_ID: ${{ secrets.CHZZK_CLIENT_ID }}
        CHZZK_CLIENT_SECRET: ${{ secrets.CHZZK_CLIENT_SECRET }}